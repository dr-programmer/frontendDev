<!DOCTYPE html>
<html lang="bg">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>React 3 - Упр. 7 - Quiz Builder</title>
    <style>
      :root {
        color-scheme: light;
        --bg: #0b1220;
        --panel: #111a2e;
        --text: #e7eefc;
        --muted: #a7b4d6;
        --border: rgba(255, 255, 255, 0.12);
        --focus: rgba(96, 165, 250, 0.45);
        --primaryBorder: rgba(96, 165, 250, 0.55);
        --dangerBorder: rgba(251, 113, 133, 0.6);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background: radial-gradient(900px 500px at 15% -10%, #1a2b5c, transparent 55%),
          radial-gradient(700px 400px at 90% 0%, #193a4a, transparent 45%), var(--bg);
        color: var(--text);
        min-height: 100svh;
        padding: 28px 16px;
      }

      .page {
        width: min(1100px, 100%);
        margin: 0 auto;
      }

      h1 {
        margin: 0 0 16px;
        font-size: 18px;
        font-weight: 700;
        color: var(--muted);
      }

      .topbar {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
      }

      .btn {
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.04);
        color: var(--text);
        padding: 10px 12px;
        border-radius: 10px;
        font-weight: 900;
        cursor: pointer;
      }

      .btn:focus-visible {
        outline: 3px solid var(--focus);
        outline-offset: 2px;
      }

      .btnPrimary {
        border-color: var(--primaryBorder);
        background: rgba(96, 165, 250, 0.18);
      }

      .btnDanger {
        border-color: var(--dangerBorder);
        background: rgba(251, 113, 133, 0.12);
      }

      .btnSmall {
        padding: 8px 10px;
        font-size: 12px;
      }

      .layout {
        display: grid;
        grid-template-columns: 1.6fr 0.8fr;
        gap: 12px;
        align-items: start;
      }

      @media (max-width: 900px) {
        .layout {
          grid-template-columns: 1fr;
        }
      }

      .panel {
        background: linear-gradient(180deg, rgba(255, 255, 255, 0.05), transparent 55%), var(--panel);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 14px;
      }

      .panelTitle {
        margin: 0 0 10px;
        font-size: 14px;
        color: var(--muted);
        font-weight: 900;
      }

      .srOnly {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      input[type="text"] {
        width: 100%;
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.04);
        color: var(--text);
        outline: none;
      }

      input[type="text"]:focus {
        box-shadow: 0 0 0 3px var(--focus);
      }

      .question {
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.04);
        border-radius: 14px;
        padding: 12px;
      }

      .question + .question {
        margin-top: 10px;
      }

      .qHead {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 10px;
      }

      .qTitle {
        font-weight: 950;
        color: var(--muted);
        font-size: 12px;
        letter-spacing: 0.2px;
      }

      .qActions {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .optRow {
        display: grid;
        grid-template-columns: 1fr auto auto;
        gap: 8px;
        align-items: center;
        margin-top: 8px;
      }

      @media (max-width: 560px) {
        .optRow {
          grid-template-columns: 1fr;
        }
      }

      .check {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: var(--muted);
        font-weight: 800;
        font-size: 12px;
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 10px 12px;
        background: rgba(255, 255, 255, 0.02);
        user-select: none;
      }

      input[type="checkbox"] {
        width: 16px;
        height: 16px;
        accent-color: rgba(96, 165, 250, 0.9);
      }

      .previewQTitle {
        margin: 0 0 10px;
        font-weight: 950;
      }

      .previewOpt {
        display: flex;
        gap: 10px;
        align-items: center;
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.03);
        color: var(--muted);
      }

      .previewOpt + .previewOpt {
        margin-top: 8px;
      }

      .empty {
        margin: 0;
        color: var(--muted);
      }

      .stat {
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 12px;
        background: rgba(255, 255, 255, 0.04);
        display: grid;
        gap: 4px;
      }

      .stat + .stat {
        margin-top: 8px;
      }

      .statLabel {
        color: var(--muted);
        font-size: 12px;
        font-weight: 900;
      }

      .statValue {
        font-weight: 950;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <div class="page">
      <h1>Задача 7: Конструктор на тестове (Quiz Builder)</h1>
      <div id="root"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.3.1/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.3.1/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"></script>

    <script type="text/babel">
      function QuizHeader({ title, onChange, isPreview }) {
        const titleInputId = React.useId();

        return (
          <div className="panel">
            <h2 className="panelTitle">
              <label htmlFor={titleInputId}>Заглавие</label>
            </h2>
            {isPreview ? (
              <div style={{ fontWeight: 950, fontSize: 18 }}>{title}</div>
            ) : (
              <input id={titleInputId} type="text" value={title} onChange={(e) => onChange(e.target.value)} />
            )}
          </div>
        );
      }

      function QuestionEditor({ question, index, total, onUpdate, onDelete, onMove }) {
        const qTextId = React.useId();
        const updateText = (text) => onUpdate({ ...question, text });

        const addOption = () => {
          if (question.options.length >= 6) return;
          onUpdate({ ...question, options: [...question.options, ""], correctIndexes: question.correctIndexes });
        };

        const updateOption = (optIndex, value) => {
          const nextOptions = question.options.map((o, i) => (i === optIndex ? value : o));
          onUpdate({ ...question, options: nextOptions });
        };

        const toggleCorrect = (optIndex) => {
          const exists = question.correctIndexes.includes(optIndex);
          const next = exists
            ? question.correctIndexes.filter((i) => i !== optIndex)
            : [...question.correctIndexes, optIndex].sort((a, b) => a - b);
          onUpdate({ ...question, correctIndexes: next });
        };

        const deleteOption = (optIndex) => {
          const nextOptions = question.options.filter((_, i) => i !== optIndex);
          const nextCorrect = question.correctIndexes
            .filter((i) => i !== optIndex)
            .map((i) => (i > optIndex ? i - 1 : i));
          onUpdate({ ...question, options: nextOptions, correctIndexes: nextCorrect });
        };

        return (
          <div className="question">
            <div className="qHead">
              <div className="qTitle">Въпрос {index + 1}</div>
              <div className="qActions">
                <button
                  className="btn btnSmall"
                  type="button"
                  onClick={() => onMove(question.id, -1)}
                  disabled={index === 0}
                  aria-label="Премести въпроса нагоре"
                >
                  ↑
                </button>
                <button
                  className="btn btnSmall"
                  type="button"
                  onClick={() => onMove(question.id, +1)}
                  disabled={index === total - 1}
                  aria-label="Премести въпроса надолу"
                >
                  ↓
                </button>
                <button className="btn btnSmall btnDanger" type="button" onClick={() => onDelete(question.id)}>
                  Изтрий въпрос
                </button>
              </div>
            </div>

            <label className="srOnly" htmlFor={qTextId}>
              Текст на въпроса {index + 1}
            </label>
            <input id={qTextId} type="text" value={question.text} onChange={(e) => updateText(e.target.value)} placeholder="Текст на въпроса..." />

            <div style={{ display: "grid", marginTop: 10 }}>
              <button className="btn btnSmall btnPrimary" type="button" onClick={addOption} disabled={question.options.length >= 6}>
                + Добави отговор ({question.options.length}/6)
              </button>
            </div>

            {question.options.map((opt, i) => (
              <div className="optRow" key={i}>
                <label className="srOnly" htmlFor={`${qTextId}-opt-${i}`}>
                  Отговор {i + 1} за въпрос {index + 1}
                </label>
                <input
                  id={`${qTextId}-opt-${i}`}
                  type="text"
                  value={opt}
                  onChange={(e) => updateOption(i, e.target.value)}
                  placeholder={`Отговор ${i + 1}...`}
                />
                <label className="check">
                  <input type="checkbox" checked={question.correctIndexes.includes(i)} onChange={() => toggleCorrect(i)} />
                  правилен
                </label>
                <button className="btn btnSmall btnDanger" type="button" onClick={() => deleteOption(i)}>
                  Изтрий
                </button>
              </div>
            ))}
          </div>
        );
      }

      function QuestionPreview({ question, index }) {
        return (
          <div className="question">
            <p className="previewQTitle">
              {index + 1}. {question.text || "—"}
            </p>

            {question.options.length === 0 ? (
              <p className="empty">Няма добавени отговори.</p>
            ) : (
              question.options.map((opt, i) => (
                <label className="previewOpt" key={i}>
                  <input type="checkbox" />
                  <span>{opt || "—"}</span>
                </label>
              ))
            )}
          </div>
        );
      }

      function QuizStats({ questions }) {
        const countQuestions = questions.length;
        const totalAnswers = questions.reduce((sum, q) => sum + q.options.length, 0);
        const withoutCorrect = questions.reduce((sum, q) => sum + (q.correctIndexes.length === 0 ? 1 : 0), 0);

        return (
          <div className="panel">
            <h2 className="panelTitle">Статистики</h2>
            <div className="stat">
              <div className="statLabel">Брой въпроси</div>
              <div className="statValue">{countQuestions}</div>
            </div>
            <div className="stat">
              <div className="statLabel">Общо отговори</div>
              <div className="statValue">{totalAnswers}</div>
            </div>
            <div className="stat">
              <div className="statLabel">Въпроси без правилен отговор</div>
              <div className="statValue">{withoutCorrect}</div>
            </div>
          </div>
        );
      }

      function QuizBuilder() {
        const [mode, setMode] = React.useState("edit"); // "edit" | "preview"
        const [title, setTitle] = React.useState("Нов тест");
        const [questions, setQuestions] = React.useState([]);

        const addQuestion = () => {
          const q = {
            id: crypto.randomUUID(),
            text: "",
            options: [],
            correctIndexes: []
          };
          setQuestions((cur) => [...cur, q]);
        };

        const updateQuestion = (id, updated) => {
          setQuestions((cur) => cur.map((q) => (q.id === id ? { ...q, ...updated } : q)));
        };

        const deleteQuestion = (id) => setQuestions((cur) => cur.filter((q) => q.id !== id));

        const moveQuestion = (id, direction) => {
          setQuestions((cur) => {
            const idx = cur.findIndex((q) => q.id === id);
            if (idx === -1) return cur;
            const nextIdx = idx + direction;
            if (nextIdx < 0 || nextIdx >= cur.length) return cur;
            const copy = [...cur];
            const [item] = copy.splice(idx, 1);
            copy.splice(nextIdx, 0, item);
            return copy;
          });
        };

        const isPreview = mode === "preview";

        return (
          <div>
            <div className="topbar">
              <button
                className="btn btnPrimary"
                type="button"
                onClick={() => setMode((m) => (m === "edit" ? "preview" : "edit"))}
              >
                {mode === "edit" ? "Преглед" : "Редактиране"}
              </button>
              <div style={{ color: "var(--muted)", fontWeight: 900, fontSize: 12 }}>
                Режим: {isPreview ? "Preview" : "Edit"}
              </div>
            </div>

            <div className="layout">
              <div style={{ display: "grid", gap: 12 }}>
                <QuizHeader title={title} onChange={setTitle} isPreview={isPreview} />

                <div className="panel">
                  <h2 className="panelTitle">{isPreview ? "Въпроси (Preview)" : "Въпроси (Edit)"}</h2>

                  {questions.length === 0 ? (
                    <p className="empty">Няма добавени въпроси.</p>
                  ) : questions.map((q, idx) =>
                    isPreview ? (
                      <QuestionPreview key={q.id} question={q} index={idx} />
                    ) : (
                      <QuestionEditor
                        key={q.id}
                        question={q}
                        index={idx}
                        total={questions.length}
                        onUpdate={(updated) => updateQuestion(q.id, updated)}
                        onDelete={deleteQuestion}
                        onMove={moveQuestion}
                      />
                    )
                  )}

                  {!isPreview && (
                    <div style={{ marginTop: 10 }}>
                      <button className="btn btnPrimary" type="button" onClick={addQuestion}>
                        + Нов въпрос
                      </button>
                    </div>
                  )}
                </div>
              </div>

              <QuizStats questions={questions} />
            </div>
          </div>
        );
      }

      const container = document.getElementById("root");
      if (ReactDOM.createRoot) {
        const root = ReactDOM.createRoot(container);
        root.render(<QuizBuilder />);
      } else {
        ReactDOM.render(<QuizBuilder />, container);
      }
    </script>
  </body>
</html>
